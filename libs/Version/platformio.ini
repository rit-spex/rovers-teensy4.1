; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

; #############################################################################
; ### Options - parameters that can be reused in one or more enviroments    ###
; #############################################################################

[options]
platform = teensy
board = teensy41
framework = arduino
upload_protocol = teensy-cli

unittesting_buildflag = -D unitTesting
generic_hw_buildflag = -D generic_hw
coverage_buildflag = 	
	-lgcov
    --coverage
    -fprofile-abs-path
	-Og


shared_libs = 

check_flags =
  cppcheck: --suppress=*:*/.pio/* --suppressions-list=../.suppress.cppcheck
  clangtidy: --checks=

# Run unit tests on generic hardware
# This includes unit tests and static analysis
[env:all_unit_tests]
platform = native
upload_protocol = ${options.upload_protocol}
lib_deps = ${options.shared_libs}
build_flags = 
	${options.generic_hw_buildflag}
	${options.unittesting_buildflag}
	${options.coverage_buildflag}

check_skip_packages = yes
check_tool = cppcheck, clangtidy
check_flags = ${options.check_flags}

test_framework = unity
test_filter = test/*
check_src_filters = 
	src/*
	test/*
